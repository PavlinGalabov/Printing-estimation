{% extends 'base.html' %}

{% block title %}
{% if object %}Edit Client{% else %}Create New Client{% endif %} - Printing Estimation
{% endblock %}

{% block extra_css %}
{% load static %}
<link href="{% static 'css/forms.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'accounts:client_list' %}">Clients</a></li>
                    <li class="breadcrumb-item active">
                        {% if object %}Edit Client{% else %}New Client{% endif %}
                    </li>
                </ol>
            </nav>
            
            <h1 class="display-6 mb-4">
                <i class="bi bi-{% if object %}pencil{% else %}person-plus{% endif %} me-2"></i>
                {% if object %}Edit Client: {{ object.company_name }}{% else %}Create New Client{% endif %}
            </h1>
        </div>
    </div>
    
    <form method="post" id="clientForm">
        {% csrf_token %}
        
        <div class="row">
            <!-- Main Form -->
            <div class="col-lg-8">
                <!-- Basic Information -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-building me-2"></i>
                            Basic Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="{{ form.company_name.id_for_label }}" class="form-label">
                                        <i class="bi bi-building me-1"></i>Company Name *
                                    </label>
                                    {{ form.company_name }}
                                    {% if form.company_name.errors %}
                                        <div class="text-danger small">{{ form.company_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <div class="form-check mt-4">
                                        {{ form.is_vip }}
                                        <label class="form-check-label" for="{{ form.is_vip.id_for_label }}">
                                            <i class="bi bi-star me-1"></i>VIP Client
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.contact_person.id_for_label }}" class="form-label">
                                        <i class="bi bi-person me-1"></i>Contact Person
                                    </label>
                                    {{ form.contact_person }}
                                    {% if form.contact_person.errors %}
                                        <div class="text-danger small">{{ form.contact_person.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.email.id_for_label }}" class="form-label">
                                        <i class="bi bi-envelope me-1"></i>Email *
                                    </label>
                                    {{ form.email }}
                                    {% if form.email.errors %}
                                        <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.phone.id_for_label }}" class="form-label">
                                        <i class="bi bi-telephone me-1"></i>Phone
                                    </label>
                                    {{ form.phone }}
                                    {% if form.phone.errors %}
                                        <div class="text-danger small">{{ form.phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.mobile.id_for_label }}" class="form-label">
                                        <i class="bi bi-phone me-1"></i>Mobile
                                    </label>
                                    {{ form.mobile }}
                                    {% if form.mobile.errors %}
                                        <div class="text-danger small">{{ form.mobile.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.website.id_for_label }}" class="form-label">
                                        <i class="bi bi-globe me-1"></i>Website
                                    </label>
                                    {{ form.website }}
                                    {% if form.website.errors %}
                                        <div class="text-danger small">{{ form.website.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Address Information -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-geo-alt me-2"></i>
                            Address Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.address_line_1.id_for_label }}" class="form-label">Address Line 1</label>
                            {{ form.address_line_1 }}
                            {% if form.address_line_1.errors %}
                                <div class="text-danger small">{{ form.address_line_1.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.address_line_2.id_for_label }}" class="form-label">Address Line 2</label>
                            {{ form.address_line_2 }}
                            {% if form.address_line_2.errors %}
                                <div class="text-danger small">{{ form.address_line_2.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.city.id_for_label }}" class="form-label">City</label>
                                    {{ form.city }}
                                    {% if form.city.errors %}
                                        <div class="text-danger small">{{ form.city.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.state_province.id_for_label }}" class="form-label">State/Province</label>
                                    {{ form.state_province }}
                                    {% if form.state_province.errors %}
                                        <div class="text-danger small">{{ form.state_province.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ form.postal_code.id_for_label }}" class="form-label">Postal Code</label>
                                    {{ form.postal_code }}
                                    {% if form.postal_code.errors %}
                                        <div class="text-danger small">{{ form.postal_code.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.country.id_for_label }}" class="form-label">Country</label>
                            {{ form.country }}
                            {% if form.country.errors %}
                                <div class="text-danger small">{{ form.country.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Business Details -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-briefcase me-2"></i>
                            Business Details
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.tax_number.id_for_label }}" class="form-label">
                                        <i class="bi bi-receipt me-1"></i>Tax Number / VAT ID
                                    </label>
                                    {{ form.tax_number }}
                                    {% if form.tax_number.errors %}
                                        <div class="text-danger small">{{ form.tax_number.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.payment_terms.id_for_label }}" class="form-label">
                                        <i class="bi bi-calendar me-1"></i>Payment Terms
                                    </label>
                                    {{ form.payment_terms }}
                                    {% if form.payment_terms.errors %}
                                        <div class="text-danger small">{{ form.payment_terms.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.credit_limit.id_for_label }}" class="form-label">
                                        <i class="bi bi-cash me-1"></i>Credit Limit (€)
                                    </label>
                                    {{ form.credit_limit }}
                                    {% if form.credit_limit.errors %}
                                        <div class="text-danger small">{{ form.credit_limit.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.discount_percentage.id_for_label }}" class="form-label">
                                        <i class="bi bi-percent me-1"></i>Default Discount (%)
                                    </label>
                                    {{ form.discount_percentage }}
                                    {% if form.discount_percentage.errors %}
                                        <div class="text-danger small">{{ form.discount_percentage.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notes -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-chat-text me-2"></i>
                            Notes & Requirements
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.notes.id_for_label }}" class="form-label">Internal Notes</label>
                            {{ form.notes }}
                            <div class="form-text">Internal notes about this client (not visible to client)</div>
                            {% if form.notes.errors %}
                                <div class="text-danger small">{{ form.notes.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.special_requirements.id_for_label }}" class="form-label">Special Requirements</label>
                            {{ form.special_requirements }}
                            <div class="form-text">Special printing requirements or preferences</div>
                            {% if form.special_requirements.errors %}
                                <div class="text-danger small">{{ form.special_requirements.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-gear me-2"></i>
                            Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-{% if object %}pencil{% else %}plus{% endif %} me-2"></i>
                                {% if object %}Update Client{% else %}Create Client{% endif %}
                            </button>
                            
                            {% if object %}
                            <a href="{% url 'jobs:create' %}?client={{ object.pk }}" class="btn btn-success">
                                <i class="bi bi-plus-circle me-2"></i>
                                New Job for Client
                            </a>
                            {% endif %}
                            
                            <a href="{% url 'accounts:client_list' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-2"></i>
                                Back to Clients
                            </a>
                        </div>
                        
                        {% if object %}
                        <hr>
                        <div class="small text-muted">
                            <div><strong>Created:</strong> {{ object.created_at|date:"M d, Y H:i" }}</div>
                            <div><strong>Updated:</strong> {{ object.updated_at|date:"M d, Y H:i" }}</div>
                            {% if object.is_vip %}
                            <div><strong>Status:</strong> 
                                <span class="badge bg-warning text-dark">VIP Client</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Quick Stats -->
                {% if object %}
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-graph-up me-2"></i>
                            Quick Stats
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="border-end">
                                    <h4 class="mb-0 text-primary">{{ object.get_jobs_count }}</h4>
                                    <small class="text-muted">Total Jobs</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <h4 class="mb-0 text-success">€{{ object.get_total_revenue|floatformat:0 }}</h4>
                                <small class="text-muted">Revenue</small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Contact Quick Info -->
                {% if object %}
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-telephone me-2"></i>
                            Quick Contact
                        </h6>
                    </div>
                    <div class="card-body">
                        {% if object.phone %}
                        <div class="mb-2">
                            <a href="tel:{{ object.phone }}" class="btn btn-outline-primary btn-sm w-100">
                                <i class="bi bi-telephone me-1"></i>Call {{ object.phone }}
                            </a>
                        </div>
                        {% endif %}
                        
                        <div class="mb-2">
                            <a href="mailto:{{ object.email }}" class="btn btn-outline-success btn-sm w-100">
                                <i class="bi bi-envelope me-1"></i>Email
                            </a>
                        </div>
                        
                        {% if object.website %}
                        <div>
                            <a href="{{ object.website }}" target="_blank" class="btn btn-outline-info btn-sm w-100">
                                <i class="bi bi-globe me-1"></i>Website
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </form>
</div>
{% endblock %}